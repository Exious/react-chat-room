(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{100:function(e,t,n){},101:function(e,t,n){},102:function(e,t,n){},103:function(e,t,n){},104:function(e,t,n){},105:function(e,t,n){"use strict";n.r(t);var c=n(1),a=n.n(c),s=n(50),r=n.n(s),i=(n(58),n(18)),o=n(2),u=n(30),l=n.n(u),d=n(51),j=n(5),O=n(52),m=n.n(O)()(),b=n(0),f=a.a.createContext(),h=function(){return a.a.useContext(f)},p=function(e){var t=e.children,n=a.a.useState(!1),c=Object(j.a)(n,2),s=c[0],r=c[1],i=a.a.useState(null),o=Object(j.a)(i,2),u=o[0],l=o[1];return Object(b.jsx)(f.Provider,{value:{isLogged:s,setIsLogged:r,roomId:u,setRoomId:l},children:t})};n(91);var v=function(){var e=a.a.useState(""),t=Object(j.a)(e,2),n=t[0],c=t[1],s=h().setIsLogged,r=Object(o.f)(),i=function(){var e=Object(d.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return",alert("\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435"));case 2:t={name:n,timestamp:Date.now()},m.emit("USER:CREATED",t),s(!0),r.push("/");case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(b.jsx)("div",{className:"login-wrapper",children:Object(b.jsxs)("div",{className:"login",children:[Object(b.jsx)("input",{className:"login__input",type:"text",placeholder:"Your nickname",value:n,onChange:function(e){return c(e.target.value)}}),Object(b.jsx)("button",{className:"login__button",onClick:i,children:"Enter"})]})})},x=n(4),E=n(21),N=function(e,t){switch(t.type){case"JOINED":return Object(x.a)(Object(x.a)({},e),{},{joined:!0,userName:t.payload.userName,roomId:t.payload.roomId});case"SET-USERS":return Object(x.a)(Object(x.a)({},e),{},{users:Object(E.a)(t.payload)});case"NEW-MESSAGE":return Object(x.a)(Object(x.a)({},e),{},{messages:[].concat(Object(E.a)(e.messages),[t.payload])});case"SET-MESSAGES-LIST":return Object(x.a)(Object(x.a)({},e),{},{messages:[].concat(Object(E.a)(e.messages),Object(E.a)(t.payload))});default:return e}};n(96);var S=function(e){var t=e.roomId,n=e.userName,c=a.a.useState(""),s=Object(j.a)(c,2),r=s[0],i=s[1],o=function(){if(r){var e={roomId:t,userName:n,type:"message",text:r,timestamp:Date.now()};m.emit("ROOM:NEW-MESSAGE",e),i("")}};return Object(b.jsxs)("div",{className:"bottom-panel-wrapper",children:[Object(b.jsx)("div",{className:"separator horizontal"}),Object(b.jsxs)("div",{className:"bottom-panel",children:[Object(b.jsx)("input",{className:"bottom-panel__input",type:"text",placeholder:"Write a message...",value:r,onChange:function(e){return i(e.target.value)},onKeyDown:function(e){"Enter"===e.key&&o()}}),Object(b.jsx)("button",{className:"bottom-panel__button",onClick:o,children:"Send"})]})]})};function R(e){return e<10?"0".concat(e):e}function g(e){var t=new Date(e.timestamp);return"".concat(R(t.getHours()),":").concat(R(t.getMinutes()))}var I=function(e){switch(e.type){case"message":return function(e){return Object(b.jsx)("div",{className:"message__wrapper",children:Object(b.jsx)("div",{className:"message_"+e.affiliation,children:Object(b.jsxs)("div",{className:"message_"+e.affiliation+"_color",children:["my"!==e.affiliation?Object(b.jsx)("span",{className:"user-name",children:e.userName}):"",Object(b.jsxs)("div",{className:"content",children:[Object(b.jsx)("p",{className:"content_text",children:e.text}),Object(b.jsx)("span",{className:"content_time",children:g(e)})]})]})})},e.timestamp)}(e);case"system":return function(e){return Object(b.jsx)("div",{className:"message__wrapper",children:Object(b.jsx)("div",{className:"message_system",children:Object(b.jsx)("p",{className:"message_system_text",children:e.text})})},e.timestamp)}(e);default:return}};n(97);var _=function(e){var t=e.roomId,n=e.messages,c=e.dispatch,s=a.a.useRef(null);return a.a.useEffect((function(){m.emit("ROOM:GET-MESSAGE-HISTORY",t)}),[t]),a.a.useEffect((function(){m.on("ROOM:RECIEVE-MESSAGE-HISTORY",(function(e){c({type:"SET-MESSAGES-LIST",payload:e})})),m.on("ROOM:RECIEVE-MESSAGE",(function(e){c({type:"NEW-MESSAGE",payload:e})}))}),[c]),a.a.useEffect((function(){s.current.scrollTo(0,100*n.length)}),[n]),Object(b.jsx)("div",{ref:s,className:"history-wrapper",children:n.map(I)})};n(98),n(99);var C=function(e){var t=e.users,n=a.a.useRef(null);return Object(b.jsxs)("div",{className:"users",children:[Object(b.jsx)("h3",{className:"users_name",children:"Users"}),Object(b.jsx)("ul",{className:"users_list",ref:n,children:t.map((function(e){var t=Object(j.a)(e,2),n=t[0],c=t[1];return Object(b.jsx)("li",{className:"users_list__item",children:n},n+c)}))})]})};n(100);var M=function(e){var t=e.users;return Object(b.jsxs)("div",{className:"online",children:["Online: ",Object(b.jsx)("span",{children:t.length})]})};n(101);var y=function(){var e=a.a.useRef(),t=a.a.useRef(),n=a.a.useRef(),c=a.a.useRef(),s=a.a.useState(!1),r=Object(j.a)(s,2),i=r[0],o=r[1],u=a.a.useState(!1),l=Object(j.a)(u,2),d=l[0],O=l[1],f=a.a.useState("non-displayed"),h=Object(j.a)(f,2),p=h[0],v=h[1],x=function(t){e.current.srcObject=t.streams[0]},E=function(e){if(e.candidate){var t={target:c.current,candidate:e.candidate};m.emit("ROOM:ICE-CANDIDATE",t)}},N=a.a.useCallback((function(e){var t=new RTCPeerConnection({iceServers:[{urls:"stun:stun.stunprotocol.org"},{urls:"turn:numb.viagenie.ca",credential:"muazkh",username:"webrtc@live.com"}]});return t.onicecandidate=E,t.ontrack=x,t.onnegotiationneeded=function(){return function(e){n.current.createOffer().then((function(e){return n.current.setLocalDescription(e)})).then((function(){var t={target:e,caller:m.id,sdp:n.current.localDescription};m.emit("ROOM:OFFER",t)}))}(e)},t}),[]),S=function(e){var t=new RTCSessionDescription(e.sdp);n.current.setRemoteDescription(t)},R=a.a.useCallback((function(e){n.current=N();var t=new RTCSessionDescription(e.sdp);n.current.setRemoteDescription(t).then((function(){return n.current.createAnswer()})).then((function(e){return n.current.setLocalDescription(e)})).then((function(){var t={target:e.caller,caller:m.id,sdp:n.current.localDescription};m.emit("ROOM:ANSWER",t)}))}),[N]),g=function(e){var t=new RTCIceCandidate(e);n.current.addIceCandidate(t)},I=a.a.useCallback((function(e){n.current=N(e),t.current.getTracks().forEach((function(e){return n.current.addTrack(e,t.current)})),c.current=e}),[N]),_=function(e){t.current=e,o((function(e){return!!t.current||e}))};return a.a.useEffect((function(){m.on("ROOM:STREAMING-CHECK",_),m.on("ROOM:STREAM-CALL",I),m.on("ROOM:ICE-CANDIDATE-RECIEVED",g),m.on("ROOM:OFFER-RECIEVED",R),m.on("ROOM:ANSWER-RECIEVED",S)}),[I,R]),Object(b.jsxs)("div",{className:"video",children:[Object(b.jsxs)("div",{className:"video_name",children:["Stream is now"," ",Object(b.jsx)("span",{className:"video_"+(i?"online":"offline"),children:i?"online":"offline"})]}),Object(b.jsx)("video",{playsInline:!0,ref:e,autoPlay:!0,className:p}),!i&&Object(b.jsx)("button",{className:"video__button",onClick:function(){navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then((function(n){e.current.srcObject=n,t.current=n,m.emit("ROOM:STREAMING-START",{streamId:n.id}),o(!0),O(!0),v("displayed")}))},children:"Start stream"}),i&&!d&&Object(b.jsx)("button",{className:"video__button",onClick:function(){m.emit("ROOM:STREAM-WANT-TO-WATCH"),O(!0),v("displayed")},children:"Start watching"})]})};var T=function(e){var t=e.roomId,n=e.users,c=e.dispatch;return a.a.useEffect((function(){m.emit("ROOM:FIND-USERS"),m.on("ROOM:GET-USERS",(function(e){console.log(e),c({type:"SET-USERS",payload:e})}))}),[c]),Object(b.jsxs)("div",{className:"sidebar",children:[Object(b.jsx)("div",{className:"separator vertical"}),Object(b.jsxs)("div",{className:"sidebar__content",children:[Object(b.jsx)("h1",{className:"sidebar__content_info",children:"Information"}),Object(b.jsxs)("div",{className:"sidebar__content_activities",children:[Object(b.jsx)(C,{users:n}),Object(b.jsx)(M,{users:n}),Object(b.jsx)(y,{roomId:t})]})]})]})};n(102);var D=function(){return Object(b.jsxs)("div",{id:"load",children:[Object(b.jsx)("div",{children:"G"}),Object(b.jsx)("div",{children:"N"}),Object(b.jsx)("div",{children:"I"}),Object(b.jsx)("div",{children:"D"}),Object(b.jsx)("div",{children:"A"}),Object(b.jsx)("div",{children:"O"}),Object(b.jsx)("div",{children:"L"})]})};n(103);var A=function(e){var t=e.roomId;return Object(b.jsx)("div",{className:"room-header",children:Object(b.jsxs)("div",{className:"room-header_id",children:[Object(b.jsx)("div",{className:"room-header_id_blur"}),Object(b.jsxs)("span",{className:"room-header_id_text",children:["Conference ",t]})]})})};n(104);var w=function(){var e=Object(o.g)().id,t=h(),n=t.isLogged,c=t.setRoomId,s=a.a.useReducer(N,{joined:!1,roomId:e,userName:null,users:[],messages:[]}),r=Object(j.a)(s,2),i=r[0],u=r[1];return a.a.useEffect((function(){n?(m.emit("ROOM:ID-CHECK",i.roomId),m.emit("ROOM:USER-JOINED",i.roomId),m.on("ROOM:USER-DATA",(function(e){u({type:"JOINED",payload:e})}))):c(i.roomId)}),[i.roomId,c,n]),i.joined?Object(b.jsxs)("div",{className:"room",children:[Object(b.jsx)(A,Object(x.a)({},i)),Object(b.jsx)("div",{className:"separator horizontal shheader"}),Object(b.jsxs)("div",{className:"room-content",children:[Object(b.jsxs)("div",{className:"chat",children:[Object(b.jsx)(_,Object(x.a)(Object(x.a)({},i),{},{dispatch:u})),Object(b.jsx)(S,Object(x.a)({},i))]}),Object(b.jsx)(T,Object(x.a)(Object(x.a)({},i),{},{dispatch:u}))]})]}):Object(b.jsx)(D,{})},k=n(107);function G(){var e=h(),t=e.isLogged,n=e.roomId;return Object(b.jsx)("div",{className:"auth-wrapper",children:t?n?Object(b.jsx)(o.a,{to:"/room/".concat(n)}):Object(b.jsx)(o.a,{to:"/room/".concat(Object(k.a)())}):Object(b.jsx)(o.a,{to:"/login"})})}var L=function(){return Object(b.jsx)(p,{children:Object(b.jsxs)(i.a,{children:[Object(b.jsx)(o.b,{path:"/",children:Object(b.jsx)(G,{})}),Object(b.jsx)(o.b,{path:"/room/:id",exact:!0,children:Object(b.jsx)(w,{})}),Object(b.jsx)(o.b,{path:"/login",exact:!0,children:Object(b.jsx)(v,{})})]})})};r.a.render(Object(b.jsx)(a.a.StrictMode,{children:Object(b.jsx)(L,{})}),document.getElementById("root"))},58:function(e,t,n){},91:function(e,t,n){},96:function(e,t,n){},97:function(e,t,n){},98:function(e,t,n){},99:function(e,t,n){}},[[105,1,2]]]);
//# sourceMappingURL=main.f9c41411.chunk.js.map