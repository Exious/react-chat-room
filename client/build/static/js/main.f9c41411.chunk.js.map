{"version":3,"sources":["socket.js","components/AuthContext.jsx","components/Login.jsx","reducer.js","components/MessageForm.jsx","messageRenderer.js","components/History.jsx","components/Users.jsx","components/Online.jsx","components/Camera.jsx","components/Side.jsx","components/Loading.jsx","components/ChatHeader.jsx","components/Room.jsx","components/Auth.jsx","App.js","index.js"],"names":["socket","io","AuthContext","React","createContext","useAuth","useContext","AuthProvider","children","useState","isLogged","setIsLogged","roomId","setRoomId","Provider","value","Login","userName","setUserName","history","useHistory","onEnter","a","alert","obj","name","timestamp","Date","now","emit","push","className","type","placeholder","onChange","e","target","onClick","reducer","state","action","joined","payload","users","messages","MessageForm","message","setMessage","onSend","text","onKeyDown","key","prettifyTime","str","getTime","date","getHours","getMinutes","renderedMessage","affiliation","userMessage","systemMessage","History","dispatch","messagesRef","useRef","useEffect","on","current","scrollTo","length","ref","map","Users","usersRef","Online","Camera","videoStream","stream","peerRef","opponent","isStream","setIsStream","watching","setWatching","videoClass","setVideoClass","handleTrackEvent","srcObject","streams","handleICECandidateEvent","candidate","createPeer","useCallback","userID","peer","RTCPeerConnection","iceServers","urls","credential","username","onicecandidate","ontrack","onnegotiationneeded","createOffer","then","offer","setLocalDescription","caller","id","sdp","localDescription","handleNegotiationNeededEvent","handleAnswer","desc","RTCSessionDescription","setRemoteDescription","handleRecieveCall","incoming","createAnswer","answer","handleNewICECandidateMsg","RTCIceCandidate","addIceCandidate","callUser","userId","getTracks","forEach","track","addTrack","streamCheck","streamObj","prev","playsInline","autoPlay","navigator","mediaDevices","getUserMedia","video","audio","streamId","Side","console","log","Loading","ChatHeader","Room","useParams","useReducer","Auth","to","uuidV4","App","path","exact","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.f9c41411.chunk.js","sourcesContent":["import io from \"socket.io-client\";\r\n\r\nconst socket = io();\r\n\r\nexport default socket;\r\n","import React from \"react\";\r\n\r\nexport const AuthContext = React.createContext();\r\n\r\nexport const useAuth = () => {\r\n  return React.useContext(AuthContext);\r\n};\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [isLogged, setIsLogged] = React.useState(false);\r\n  const [roomId, setRoomId] = React.useState(null);\r\n  return (\r\n    <AuthContext.Provider value={{ isLogged, setIsLogged, roomId, setRoomId }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n","import React from \"react\";\r\n\r\nimport socket from \"../socket\";\r\n\r\nimport { useHistory } from \"react-router-dom\";\r\n\r\nimport { useAuth } from \"./AuthContext\";\r\n\r\nimport \"../styles/Login.css\";\r\n\r\nfunction Login() {\r\n  const [userName, setUserName] = React.useState(\"\");\r\n\r\n  const { setIsLogged } = useAuth();\r\n\r\n  const history = useHistory();\r\n\r\n  const onEnter = async () => {\r\n    if (!userName) {\r\n      return alert(\"Неверные данные\");\r\n    }\r\n\r\n    const obj = {\r\n      name: userName,\r\n      timestamp: Date.now(),\r\n    };\r\n\r\n    socket.emit(\"USER:CREATED\", obj);\r\n\r\n    setIsLogged(true);\r\n\r\n    history.push(\"/\");\r\n  };\r\n\r\n  return (\r\n    <div className=\"login-wrapper\">\r\n      <div className=\"login\">\r\n        <input\r\n          className=\"login__input\"\r\n          type=\"text\"\r\n          placeholder=\"Your nickname\"\r\n          value={userName}\r\n          onChange={(e) => setUserName(e.target.value)}\r\n        />\r\n        <button className=\"login__button\" onClick={onEnter}>\r\n          Enter\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Login;\r\n","const reducer = (state, action) => {\r\n  switch (action.type) {\r\n    case \"JOINED\":\r\n      return {\r\n        ...state,\r\n        joined: true,\r\n        userName: action.payload.userName,\r\n        roomId: action.payload.roomId,\r\n      };\r\n\r\n    case \"SET-USERS\":\r\n      return {\r\n        ...state,\r\n        users: [...action.payload],\r\n      };\r\n\r\n    case \"NEW-MESSAGE\":\r\n      return {\r\n        ...state,\r\n        messages: [...state.messages, action.payload],\r\n      };\r\n\r\n    case \"SET-MESSAGES-LIST\":\r\n      return {\r\n        ...state,\r\n        messages: [...state.messages, ...action.payload],\r\n      };\r\n\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n\r\nexport default reducer;\r\n","import React from \"react\";\r\n\r\nimport socket from \"../socket\";\r\n\r\nimport \"../styles/MessageForm.css\";\r\n\r\nfunction MessageForm({ roomId, userName }) {\r\n  const [message, setMessage] = React.useState(\"\");\r\n\r\n  const onSend = () => {\r\n    if (message) {\r\n      const obj = {\r\n        roomId,\r\n        userName,\r\n        type: \"message\",\r\n        text: message,\r\n        timestamp: Date.now(),\r\n      };\r\n      socket.emit(\"ROOM:NEW-MESSAGE\", obj);\r\n      setMessage(\"\");\r\n    }\r\n  };\r\n\r\n  const handleEnter = (e) => {\r\n    if (e.key === \"Enter\") onSend();\r\n  };\r\n\r\n  return (\r\n    <div className=\"bottom-panel-wrapper\">\r\n      <div className=\"separator horizontal\"></div>\r\n      <div className=\"bottom-panel\">\r\n        <input\r\n          className=\"bottom-panel__input\"\r\n          type=\"text\"\r\n          placeholder=\"Write a message...\"\r\n          value={message}\r\n          onChange={(e) => setMessage(e.target.value)}\r\n          onKeyDown={handleEnter}\r\n        />\r\n        <button className=\"bottom-panel__button\" onClick={onSend}>\r\n          Send\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default MessageForm;\r\n","function prettifyTime(str) {\r\n  return str < 10 ? `0${str}` : str;\r\n}\r\n\r\nfunction getTime(message) {\r\n  const date = new Date(message.timestamp);\r\n  return `${prettifyTime(date.getHours())}:${prettifyTime(date.getMinutes())}`;\r\n}\r\n\r\nfunction userMessage(message) {\r\n  return (\r\n    <div className=\"message__wrapper\" key={message.timestamp}>\r\n      <div className={\"message_\" + message.affiliation}>\r\n        <div className={\"message_\" + message.affiliation + \"_color\"}>\r\n          {message.affiliation !== \"my\" ? (\r\n            <span className=\"user-name\">{message.userName}</span>\r\n          ) : (\r\n            \"\"\r\n          )}\r\n          <div className=\"content\">\r\n            <p className=\"content_text\">{message.text}</p>\r\n            <span className=\"content_time\">{getTime(message)}</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction systemMessage(message) {\r\n  return (\r\n    <div className=\"message__wrapper\" key={message.timestamp}>\r\n      <div className=\"message_system\">\r\n        <p className=\"message_system_text\">{message.text}</p>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction renderedMessage(message) {\r\n  switch (message.type) {\r\n    case \"message\":\r\n      return userMessage(message);\r\n    case \"system\":\r\n      return systemMessage(message);\r\n    default:\r\n      return;\r\n  }\r\n}\r\n\r\nexport default renderedMessage;\r\n","import React from \"react\";\r\n\r\nimport socket from \"../socket\";\r\n\r\nimport renderedMessage from \"../messageRenderer\";\r\n\r\nimport \"../styles/History.css\";\r\n\r\nfunction History({ roomId, messages, dispatch }) {\r\n  const messagesRef = React.useRef(null);\r\n\r\n  React.useEffect(() => {\r\n    socket.emit(\"ROOM:GET-MESSAGE-HISTORY\", roomId);\r\n  }, [roomId]);\r\n\r\n  React.useEffect(() => {\r\n    socket.on(\"ROOM:RECIEVE-MESSAGE-HISTORY\", (messages) => {\r\n      dispatch({\r\n        type: \"SET-MESSAGES-LIST\",\r\n        payload: messages,\r\n      });\r\n    });\r\n\r\n    socket.on(\"ROOM:RECIEVE-MESSAGE\", (message) => {\r\n      dispatch({\r\n        type: \"NEW-MESSAGE\",\r\n        payload: message,\r\n      });\r\n    });\r\n  }, [dispatch]);\r\n\r\n  React.useEffect(() => {\r\n    messagesRef.current.scrollTo(0, messages.length * 100);\r\n  }, [messages]);\r\n\r\n  return (\r\n    <div ref={messagesRef} className=\"history-wrapper\">\r\n      {messages.map(renderedMessage)}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default History;\r\n","import React from \"react\";\r\n\r\nimport \"../styles/Users.css\";\r\n\r\nfunction Users({ users }) {\r\n  const usersRef = React.useRef(null);\r\n\r\n  return (\r\n    <div className=\"users\">\r\n      <h3 className=\"users_name\">Users</h3>\r\n      <ul className=\"users_list\" ref={usersRef}>\r\n        {users.map(([userName, timestamp]) => (\r\n          <li className=\"users_list__item\" key={userName + timestamp}>\r\n            {userName}\r\n          </li>\r\n        ))}\r\n      </ul>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Users;\r\n","import React from \"react\";\r\n\r\nimport \"../styles/Online.css\";\r\n\r\nfunction Online({ users }) {\r\n  return (\r\n    <div className=\"online\">\r\n      {\"Online: \"}\r\n      <span>{users.length}</span>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Online;\r\n","import React from \"react\";\r\n\r\nimport socket from \"../socket\";\r\n\r\nimport \"../styles/Camera.css\";\r\n\r\nfunction Camera() {\r\n  const videoStream = React.useRef();\r\n  const stream = React.useRef();\r\n  const peerRef = React.useRef();\r\n  const opponent = React.useRef();\r\n  const [isStream, setIsStream] = React.useState(false);\r\n  const [watching, setWatching] = React.useState(false);\r\n  const [videoClass, setVideoClass] = React.useState(\"non-displayed\");\r\n\r\n  const handleNegotiationNeededEvent = (userID) => {\r\n    peerRef.current\r\n      .createOffer()\r\n      .then((offer) => {\r\n        return peerRef.current.setLocalDescription(offer);\r\n      })\r\n      .then(() => {\r\n        const payload = {\r\n          target: userID,\r\n          caller: socket.id,\r\n          sdp: peerRef.current.localDescription,\r\n        };\r\n        socket.emit(\"ROOM:OFFER\", payload);\r\n      });\r\n  };\r\n\r\n  const handleTrackEvent = (e) => {\r\n    videoStream.current.srcObject = e.streams[0];\r\n  };\r\n\r\n  const handleICECandidateEvent = (e) => {\r\n    if (e.candidate) {\r\n      const payload = {\r\n        target: opponent.current,\r\n        candidate: e.candidate,\r\n      };\r\n      socket.emit(\"ROOM:ICE-CANDIDATE\", payload);\r\n    }\r\n  };\r\n\r\n  const createPeer = React.useCallback((userID) => {\r\n    const peer = new RTCPeerConnection({\r\n      iceServers: [\r\n        {\r\n          urls: \"stun:stun.stunprotocol.org\",\r\n        },\r\n        {\r\n          urls: \"turn:numb.viagenie.ca\",\r\n          credential: \"muazkh\",\r\n          username: \"webrtc@live.com\",\r\n        },\r\n      ],\r\n    });\r\n\r\n    peer.onicecandidate = handleICECandidateEvent;\r\n    peer.ontrack = handleTrackEvent;\r\n    peer.onnegotiationneeded = () => handleNegotiationNeededEvent(userID);\r\n\r\n    return peer;\r\n  }, []);\r\n\r\n  const handleAnswer = (message) => {\r\n    const desc = new RTCSessionDescription(message.sdp);\r\n    peerRef.current.setRemoteDescription(desc);\r\n  };\r\n\r\n  const handleRecieveCall = React.useCallback(\r\n    (incoming) => {\r\n      peerRef.current = createPeer();\r\n      const desc = new RTCSessionDescription(incoming.sdp);\r\n      peerRef.current\r\n        .setRemoteDescription(desc)\r\n        .then(() => {\r\n          return peerRef.current.createAnswer();\r\n        })\r\n        .then((answer) => {\r\n          return peerRef.current.setLocalDescription(answer);\r\n        })\r\n        .then(() => {\r\n          const payload = {\r\n            target: incoming.caller,\r\n            caller: socket.id,\r\n            sdp: peerRef.current.localDescription,\r\n          };\r\n          socket.emit(\"ROOM:ANSWER\", payload);\r\n        });\r\n    },\r\n    [createPeer]\r\n  );\r\n\r\n  const handleNewICECandidateMsg = (incoming) => {\r\n    const candidate = new RTCIceCandidate(incoming);\r\n    peerRef.current.addIceCandidate(candidate);\r\n  };\r\n\r\n  const callUser = React.useCallback(\r\n    (userId) => {\r\n      peerRef.current = createPeer(userId);\r\n      stream.current\r\n        .getTracks()\r\n        .forEach((track) => peerRef.current.addTrack(track, stream.current));\r\n      opponent.current = userId;\r\n    },\r\n    [createPeer]\r\n  );\r\n\r\n  const streamCheck = (streamObj) => {\r\n    stream.current = streamObj;\r\n    setIsStream((prev) => (!!stream.current ? true : prev));\r\n  };\r\n\r\n  const startWatching = () => {\r\n    socket.emit(\"ROOM:STREAM-WANT-TO-WATCH\");\r\n    setWatching(true);\r\n    setVideoClass(\"displayed\");\r\n  };\r\n\r\n  const startStreaming = () => {\r\n    navigator.mediaDevices\r\n      .getUserMedia({ video: true, audio: true })\r\n      .then((streamObj) => {\r\n        videoStream.current.srcObject = streamObj;\r\n        stream.current = streamObj;\r\n        socket.emit(\"ROOM:STREAMING-START\", { streamId: streamObj.id });\r\n        setIsStream(true);\r\n        setWatching(true);\r\n        setVideoClass(\"displayed\");\r\n      });\r\n  };\r\n\r\n  React.useEffect(() => {\r\n    socket.on(\"ROOM:STREAMING-CHECK\", streamCheck);\r\n    socket.on(\"ROOM:STREAM-CALL\", callUser);\r\n    socket.on(\"ROOM:ICE-CANDIDATE-RECIEVED\", handleNewICECandidateMsg);\r\n    socket.on(\"ROOM:OFFER-RECIEVED\", handleRecieveCall);\r\n    socket.on(\"ROOM:ANSWER-RECIEVED\", handleAnswer);\r\n  }, [callUser, handleRecieveCall]);\r\n\r\n  return (\r\n    <div className=\"video\">\r\n      <div className=\"video_name\">\r\n        Stream is now{\" \"}\r\n        <span className={\"video_\" + (isStream ? \"online\" : \"offline\")}>\r\n          {isStream ? \"online\" : \"offline\"}\r\n        </span>\r\n      </div>\r\n      <video playsInline ref={videoStream} autoPlay className={videoClass} />\r\n      {!isStream && (\r\n        <button className=\"video__button\" onClick={startStreaming}>\r\n          Start stream\r\n        </button>\r\n      )}\r\n      {isStream && !watching && (\r\n        <button className=\"video__button\" onClick={startWatching}>\r\n          Start watching\r\n        </button>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Camera;\r\n","import React from \"react\";\r\n\r\nimport socket from \"../socket\";\r\n\r\nimport \"../styles/Side.css\";\r\n\r\nimport Users from \"./Users\";\r\nimport Online from \"./Online\";\r\nimport Camera from \"./Camera\";\r\n\r\nfunction Side({ roomId, users, dispatch }) {\r\n  React.useEffect(() => {\r\n    socket.emit(\"ROOM:FIND-USERS\");\r\n    socket.on(\"ROOM:GET-USERS\", (obj) => {\r\n      console.log(obj);\r\n      dispatch({\r\n        type: \"SET-USERS\",\r\n        payload: obj,\r\n      });\r\n    });\r\n  }, [dispatch]);\r\n\r\n  return (\r\n    <div className=\"sidebar\">\r\n      <div className=\"separator vertical\"></div>\r\n      <div className=\"sidebar__content\">\r\n        <h1 className=\"sidebar__content_info\">Information</h1>\r\n        <div className=\"sidebar__content_activities\">\r\n          <Users users={users} />\r\n          <Online users={users} />\r\n          <Camera roomId={roomId} />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Side;\r\n","import React from \"react\";\r\n\r\nimport \"../styles/Loading.css\";\r\n\r\nfunction Loading() {\r\n  return (\r\n    <div id=\"load\">\r\n      <div>G</div>\r\n      <div>N</div>\r\n      <div>I</div>\r\n      <div>D</div>\r\n      <div>A</div>\r\n      <div>O</div>\r\n      <div>L</div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Loading;\r\n","import React from \"react\";\r\n\r\nimport \"../styles/ChatHeader.css\";\r\n\r\nfunction ChatHeader({ roomId }) {\r\n  return (\r\n    <div className=\"room-header\">\r\n      <div className=\"room-header_id\">\r\n        <div className=\"room-header_id_blur\"></div>\r\n        <span className=\"room-header_id_text\">Conference {roomId}</span>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default ChatHeader;\r\n","import React from \"react\";\r\nimport { useParams } from \"react-router-dom\";\r\n\r\nimport socket from \"../socket\";\r\nimport reducer from \"../reducer\";\r\n\r\nimport MessageForm from \"./MessageForm\";\r\nimport History from \"./History\";\r\nimport Side from \"./Side\";\r\nimport Loading from \"./Loading\";\r\nimport ChatHeader from \"./ChatHeader\";\r\n\r\nimport \"../styles/Room.css\";\r\n\r\nimport { useAuth } from \"./AuthContext\";\r\n\r\nfunction Room() {\r\n  const { id } = useParams();\r\n\r\n  const { isLogged, setRoomId } = useAuth();\r\n\r\n  const [state, dispatch] = React.useReducer(reducer, {\r\n    joined: false,\r\n    roomId: id,\r\n    userName: null,\r\n    users: [],\r\n    messages: [],\r\n  });\r\n\r\n  React.useEffect(() => {\r\n    if (isLogged) {\r\n      socket.emit(\"ROOM:ID-CHECK\", state.roomId);\r\n      socket.emit(\"ROOM:USER-JOINED\", state.roomId);\r\n      socket.on(\"ROOM:USER-DATA\", (obj) => {\r\n        dispatch({\r\n          type: \"JOINED\",\r\n          payload: obj,\r\n        });\r\n      });\r\n    } else {\r\n      setRoomId(state.roomId);\r\n    }\r\n  }, [state.roomId, setRoomId, isLogged]);\r\n\r\n  return state.joined ? (\r\n    <div className=\"room\">\r\n      <ChatHeader {...state} />\r\n      <div className=\"separator horizontal shheader\"></div>\r\n      <div className=\"room-content\">\r\n        <div className=\"chat\">\r\n          <History {...state} dispatch={dispatch} />\r\n          <MessageForm {...state} />\r\n        </div>\r\n        <Side {...state} dispatch={dispatch} />\r\n      </div>\r\n    </div>\r\n  ) : (\r\n    <Loading />\r\n  );\r\n}\r\n\r\nexport default Room;\r\n","import React from \"react\";\r\nimport { Redirect } from \"react-router-dom\";\r\nimport { v4 as uuidV4 } from \"uuid\";\r\nimport { useAuth } from \"./AuthContext\";\r\n\r\nexport default function Auth() {\r\n  const { isLogged, roomId } = useAuth();\r\n\r\n  return (\r\n    <div className=\"auth-wrapper\">\r\n      {isLogged ? (\r\n        roomId ? (\r\n          <Redirect to={`/room/${roomId}`} />\r\n        ) : (\r\n          <Redirect to={`/room/${uuidV4()}`} />\r\n        )\r\n      ) : (\r\n        <Redirect to=\"/login\" />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import React from \"react\";\nimport { BrowserRouter as Router, Route } from \"react-router-dom\";\n\nimport Login from \"./components/Login\";\nimport Room from \"./components/Room\";\nimport Auth from \"./components/Auth\";\nimport { AuthProvider } from \"./components/AuthContext\";\n\nfunction App() {\n  return (\n    <AuthProvider>\n      <Router>\n        <Route path=\"/\">\n          <Auth />\n        </Route>\n        <Route path=\"/room/:id\" exact>\n          <Room />\n        </Route>\n        <Route path=\"/login\" exact>\n          <Login />\n        </Route>\n      </Router>\n    </AuthProvider>\n  );\n}\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./styles/index.css\";\nimport App from \"./App\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}